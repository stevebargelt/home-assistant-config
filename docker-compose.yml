version: '3.7'
services:
  mqtt-int:
    image: eclipse-mosquitto
    restart: always
    ports: 
      - "1883:1883"
    volumes:
        - /Users/steve/ha/home-assistant-config/mosquitto-int.conf:/mosquitto/config/mosquitto.conf
        - /Users/steve/ha/mosquitto/data
        - /Users/steve/ha/mosquitto/log
  influxdb:
    image: influxdb
    restart: always
    ports:
      - "8086:8086"
    volumes:
      #- /home/pi/influxdb:/var/lib/influxdb
      - /Users/steve/ha/influxdb:/data
  grafana:
    image: grafana/grafana
    restart: always 
    depends_on:
      - influxdb
    ports:
      - "3000:3000"
    volumes: 
      - /Users/steve/ha/grafana:/var/lib/grafana
  
  home-assistant:
    image: homeassistant/home-assistant
    restart: always
    depends_on:
      - mqtt-int
      - influxdb
    environment:
      - TZ=America/Los_Angeles
    ports:
      - "8123:8123"
      - "8300:8300"
    volumes:
      - /Users/steve/ha/letsencrypt:/etc/letsencrypt
      - /Users/steve/ha/home-assistant-config:/config

  node-red:
    image: nodered/node-red-docker
    restart: always
    ports:
      - "1880:1880"
    volumes: 
      - /Users/steve/ha/node-red-data:/data
  # dasher:
  #   image: nekmo/amazon-dash:latest  
  #   volumes:
  #     - /Users/steve/ha/dasher/config:/usr/src/app/config
  #   entrypoint:
  #     - amazon-dash run 
  #     - --ignore-perms 
  #     - --root-allowed
  #     - --config /config/amazon-dash.yml

